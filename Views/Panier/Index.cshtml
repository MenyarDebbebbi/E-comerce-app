@using System.Globalization
@using System.Linq
@using WebApplication2.Models
@{
ViewBag.Title = "Index";
var orderHistory = ViewBag.OrderHistory as IEnumerable<Order>;
}
<body>
<div>
@if (ViewBag.Liste.Count > 0)
{
<table class="table table-hover">
<tr class="carousel">
<th>
<h5><strong>Produit</strong></h5>
</th>
<th class="danger">
<h5><strong>Description</strong></h5>
</th>
</tr>
@foreach (var item in ViewBag.Liste)
{
<tr id="row-@item.Prod.ProductId">
<td>
<img src="~/images/@item.Prod.Image" style="width:250px;height:250px">
</td>
<td>
                <h5>Nom : @item.Prod.Name </h5><hr/>
                <h5>Catégorie : @item.Prod.Category.CategoryName </h5><hr/>
                <h5>Prix unitaire : @item.Prod.Price DT</h5><hr/>
                <div class="d-flex align-items-center mb-3">
                    <h5 class="me-3 mb-0">Quantité : <span id="quantite_@item.Prod.ProductId">@item.quantite</span></h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-danger MinProducts" data-id="@item.Prod.ProductId" title="Diminuer">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success PlusProducts" data-id="@item.Prod.ProductId" title="Augmenter">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger RemoveLink" data-id="@item.Prod.ProductId" title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <hr />
                <h5>
                    Prix de <span id="rquantite_@item.Prod.ProductId">@item.quantite</span> article(s) : <span id="total_@item.Prod.ProductId">@item.TotalPrice</span> DT
                </h5>
                        </td>
                    </tr>
                }
            </table>
            <div class="mt-4">
                <h4><strong>Prix total à payer : <span id="totalapayer">@ViewBag.total</span> DT</strong></h4>
            </div>
            @if (ViewBag.total > 0)
            {
                <div class="mt-3">
                    <a href="~/Product/Index" class="btn btn-secondary" role="button">Continuer mes achats</a>
                    <a href="~/Panier/Checkout" class="btn btn-success" role="button">Commander »</a>
                </div>
            }
        }
        else
        {
            <div class="text-center mt-5">
                <div class="empty-cart-icon mx-auto">
                    <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i>
                    <span class="visually-hidden">Panier vide</span>
                </div>
                <h3 class="mt-3 text-muted">Votre panier est vide !</h3>
                <p class="text-muted">Partez à la découverte de nos produits et faites-vous plaisir </p>
                <a href="~/Product/Index" class="btn btn-primary mt-3">Voir les produits</a>
            </div>
        }
        <section class="mt-12 border-t border-gray-200 pt-6">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">Historique d'achat</h3>
            @if (User?.Identity?.IsAuthenticated != true)
            {
                <p class="text-gray-600">Connectez-vous pour consulter vos commandes précédentes.</p>
            }
            else if (orderHistory?.Any() == true)
            {
                <div class="space-y-6">
                    @foreach (var order in orderHistory)
                    {
                        <article class="bg-white shadow-md rounded-lg p-6 space-y-4">
                            <header class="flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Commande</p>
                                    <p class="text-lg font-semibold text-gray-800">#@order.Id</p>
                                </div>
                                <dl class="grid grid-cols-1 gap-4 text-sm text-gray-600 sm:grid-cols-3">
                                    <div>
                                        <dt class="font-medium text-gray-500 uppercase tracking-wide">Date</dt>
                                        <dd>@order.OrderDate.ToString("dd MMM yyyy", CultureInfo.CurrentCulture)</dd>
                                    </div>
                                    <div>
                                        <dt class="font-medium text-gray-500 uppercase tracking-wide">Total</dt>
                                        <dd>@order.TotalAmount.ToString("0.00") DT</dd>
                                    </div>
                                    <div>
                                        <dt class="font-medium text-gray-500 uppercase tracking-wide">Statut</dt>
                                        <dd class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-xs font-semibold text-green-700">Confirmée</dd>
                                    </div>
                                </dl>
                            </header>
                            @if (order.Items?.Any() == true)
                            {
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Produit</th>
                                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Quantité</th>
                                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Prix unitaire</th>
                                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500">Sous-total</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200 bg-white">
                                            @foreach (var item in order.Items)
                                            {
                                                <tr>
                                                    <td class="px-4 py-2 text-sm text-gray-700">@item.ProductName</td>
                                                    <td class="px-4 py-2 text-sm text-gray-700">@item.Quantity</td>
                                                    <td class="px-4 py-2 text-sm text-gray-700">@item.Price.ToString("0.00") DT</td>
                                                    <td class="px-4 py-2 text-sm text-gray-700">@((item.Price * item.Quantity).ToString("0.00")) DT</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <p class="text-sm text-gray-600">Aucun article détaillé n'est disponible pour cette commande.</p>
                            }
                        </article>
                    }
                </div>
            }
            else
            {
                <p class="text-gray-600">Vous n'avez pas encore passé de commande.</p>
            }
        </section>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/js/Monscript.js" type="text/javascript"></script>
</body>